<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>吃货福利</title>
		<meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<script src="../js/jquery.min.js"></script>
		<script src="../js/TouchSlide.1.1.js"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=DQm1huuHqW6SHaYpEnrVMtE4fDmDrxVH"></script>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" href="../css/style1.css">
		<link rel="stylesheet" href="../css/comment.css">
		<link href="css/style.css " rel="stylesheet " />
		<style type="text/css ">
			.widthmax {
				width: 100%;
			}
			
			#bianji-text p img {
				width: 100%;
			}
			
			body {
				margin: 0;
				background: #eee;
				font-size: 1.2rem;
				line-height: 1.6;
				color: #0e0e0e;
				font-family: '微软雅黑', Verdana, Arial, Helvetica, sans-serif;
			}
			
			* {
				margin: 0px;
				padding: 0px;
			}
			
			input::-webkit-input-placeholder,
			textarea::-webkit-input-placeholder {
				font-size: 12px;
				padding-left: 2px;
				color: #ADADAD;
			}
			
			input:-moz-placeholder,
			textarea:-moz-placeholder {
				color: #ADADAD;
				font-size: 12px;
				padding-left: 2px;
			}
			
			input::-moz-placeholder,
			textarea::-moz-placeholder {
				color: #ADADAD;
				font-size: 12px;
				padding-left: 2px;
			}
			
			input:-ms-input-placeholder,
			textarea:-ms-input-placeholder {
				color: #ADADAD;
				font-size: 12px;
				padding-left: 2px;
			}
			
			@media only screen and (max-width:310px) {
				.right-mui-sapn {
					width: 100%;
					margin: 0 auto;
				}
			}
			
			.footer-pic {
				float: left;
				margin-left: 30%;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav" style="background: #212123;color: white;">
			<a class="mui-icon mui-action-back mui-icon-left-nav mui-pull-left" style="color: white;"></a>
			<span class="mui-icon mui-icon-reply mui-pull-right"></span>
			<h1 class="mui-title" id="proName" style="color: white;">加载...</h1>
		</header>
		<!--<div>
			<button class="mui-btn mui-btn-postive mui-btn-outlined"  style="margin-top: 50px;">分享</button>
		</div>-->
		<div id="faxian-all" style="margin-top: 45px; background: white;">

			<div class="bianji-text" id="bianji-text">

			</div>
			<div id="document-down" style="margin-top: 20px;">
				<div style="border: 1px solid #DDDDDD;border-bottom: none;"></div>

				<div class="commentAll">
					<!--评论区域 begin-->
					<div class="reviewArea clearfix" id="pingltextare" style="display: none;" >
						<textarea class="content comment-input" onkeyup="keyUP(this)"></textarea>
						<a href="javascript:;" class="plBtn" onclick="sub()">评论</a>
					</div>
					<!--评论区域 end-->
					<!--回复区域 begin-->
					<div class="comment-show" id="comment-show" >
					</div>
					
					<!--回复区域 end-->
				</div>

				<div id="footer-down" style="position: fixed;background-color: white;bottom: 0;width: 100%;height: 50px; z-index: 999;">
					<div style="border: 1px solid #DDDDDD;border-bottom: none;"></div>
					<a href="javascript:;" id="footer-fenxiang"  onclick="show()">
				
						<div style="float: left; height: 48px; width: 40%; border: 1px solid #DDDDDD;border-left: none;border-top: none ;">
							<img src="img/btn_faxian-fenxiang.png"  style="margin: 8% 30%; width: 40%;" />
						</div>
					</a>

					<a href="javascript:;" class="plBtns" id="footer-pinglun" onclick="Djtext()">
						<div id="pinlun" style="float: right; height: 48px; width: 60%; border: 1px solid #DDDDDD;border-left: none;border-right: none;border-top: none ; display: block;">
							<img src="img/btn_faxian-pinglun.png" style="margin: 5.3% 35.5%; width: 29%;" />
						</div>
					</a>

				</div>
			</div>
			<div id="faxian-fenxiang" style="background: rgba(0,0,0,0.12);display: none; position: fixed;bottom: 0;width: 100%; ">
				<div style="width: 100%; height: 230px;z-index: 999;position: relative;"></div>
				<div style="background: white; ">
					<div style="line-height: 4;">
						<p style="font-size: 16px;text-align: center; color: black;">分享给好友</p>
					</div>
					<div style="height: 200px; margin-top: 20px;">
						<div style="height: 90px;">
							<div style="float: left;width: 30%;margin-left: 5%;text-align: center;" id="forshare" onclick="shareHref()">
								<a href="javascript:;"><img src="img/btn_faxian-wechat.png" style="width: 40px" /></a>
							</div>
							<div style="float: left;width: 30%;text-align: center;">
								<a href="#"><img src="img/btn-faxian-QQ.png" style="width: 38px;" /></a>
							</div>
							<div style="float: left;width: 30%;margin-right: 5%;text-align: center;">
								<a href="#"><img src="img/btn_faxian-weibo.png" style="width: 40px;" /> </a>
							</div>
						</div>
						<div>
							<div style="float: left;width: 30%;margin-left: 5%;text-align: center;">
								<a href="#"><img src="img/btn_faxian-friedroom@2.png" style="width: 40px;" /> </a>
							</div>
							<div style="float: left;width: 30%;text-align: center;">
								<a href="#"><img src="img/btn_faxian-QQroom@2.png" style="width: 45px;margin-top: -5px; " /></a>
							</div>
							<div style="float: left;width: 30%;margin-right: 5%;text-align: center;"> </div>
						</div>
					</div>
				</div>
				<a href="javascript:" id="quxiao" style="text-decoration: none;" onclick="hiden()">
					<div style="background: #CFA972;width: 100%;height: 50px; text-align: center;line-height: 3;">
						<span style="font-size: 16px;color: black;">取消</span>
					</div>
				</a>
			</div>
		</div>
		
	</body>
	<script src="../js/MD5S.js "></script>
	<script src="../js/mui.min.js"></script>
	<!--<script src="../js/mui.previewimage.js"></script>-->
	<!--<script src="../js/mui.zoom.js"></script>-->
	<script src="../js/TravelTailorSafeInterface.js "></script>
	<script type="text/javascript" src="../js/jquery.flexText.js"></script>
	<script type="text/javascript">
//插件的JS
		$(function() {
			$('.content').flexText();
			getPeoplePosition();
		});

<!--textarea限制字数-->
		function keyUP(t) {
			var len = $(t).val().length;
			if(len > 139) {
				$(t).val($(t).val().substring(0, 140));
			}
			if(len == 0) {
				$(".plBtn").css("background-color", "#DDDDDD");
				$(".plBtn").attr("disabled", true); 
			} else {
				$(".plBtn").css("background-color", "#CFA972");
			}
		}

<!--点击评论创建评论条-->
		function sub(){
			if(lng==""&&lat==""){
				mui.alert("数据正在加载中");
			}else{
				GetDiscuss();
				document.getElementById("pingltextare").style.display="none";
			}
			
		}
		var CommentInfo='';
				function GetDiscuss() {
					var textnri = $(".comment-input").val();
					localStorage.setItem("TextAreInf",textnri);
					var ar = new Array();
					ar.InterfaceAddress = "api/AddAccess";
					ar.NodeId=nodeId;
					console.debug(nodeId);
					ar.UserId = localStorage.getItem("UserId");
					ar.UserName = localStorage.getItem("UserName");
					CommentInfo=textnri;
					ar.CommentInfo = textnri;
					ar.CommentStars = "5";
					ar.Long = lng;
					ar.Dismension=lat;
					ar.status="1";
					aes(ar, "endGetDiscuss");
				}
				var TupId = "";
				
				
				function endGetDiscuss(rs) {
//					debugger;
					if(CommentInfo==""){
					mui.alert("评论不能为空");
					}else{
						if(rs){
							var oDate=CurentTime('-',true);
							var ahtml='<div class="comment-show-con clearfix" ><div class="comment-show-con-img pull-left" style="width: 18%;"><img src="../images/header-img-comment_03.png" alt=""></div>';
							ahtml+='<div class="comment-show-con-list pull-left clearfix">	<div class="pl-text clearfix">';
							ahtml+='<a href="#" class="comment-size-name">'+localStorage.getItem("UserName")+' : </a>';
							ahtml+='<span class="my-pl-con">&nbsp;'+CommentInfo+'</span></div>';
							ahtml+='<div class="date-dz"><span class="date-dz-left pull-left comment-time">'+oDate+'</span>';
							ahtml+='<div class="date-dz-right pull-right comment-pl-block">';
							//ahtml+='<a href="javascript:;" class="date-dz-pl pl-hf hf-con-block pull-left">回复</a><span class="pull-left date-dz-line">|</span>';
							ahtml+='<a href="javascript:;" class="date-dz-z pull-left"><i class="date-dz-z-click-red"></i>赞 (<i class="z-num">0</i>)</a></div></div>';
							ahtml+='<div class="hf-list-con"></div></div></div>';
							document.getElementById("comment-show").innerHTML=ahtml+document.getElementById("comment-show").innerHTML;
						}else{
							mui.alert("评论失败,请重新进入此页面评论","黑卡生活");
						}
					}
					
				}
//<!--点赞-->
	DzElementId="";
	var TupNum="";
		$('.comment-show').on('click', '.date-dz-z', function(e) {
			TupNum++;
			DzElementId=$(e.target).attr('id'); 
			console.debug(DzElementId);
			var zNum = $(this).find('.z-num').html();
			if($(this).is('.date-dz-z-click')) {
				zNum--;
				$(this).removeClass('date-dz-z-click red');
				$(this).find('.z-num').html(zNum);
				$(this).find('.date-dz-z-click-red').removeClass('red');
			} else {
				zNum++;
				$(this).addClass('date-dz-z-click');
				$(this).find('.z-num').html(zNum);
				$(this).find('.date-dz-z-click-red').addClass('red');
			}
			GetLike();
			if(TupNum%2==1){
				TupNum=1;
			}else if(TupNum%2==0){
				TupNum=2;
			}
			console.debug(TupNum);
				
		})
		
		
		
	function GetLike() {
		if(TupNum==3){
			TupNum=1;
		}
		var ar = new Array();
		ar.InterfaceAddress = "api/TUP";
		ar.userid=localStorage.getItem("UserId");
		console.debug(DzElementId);
		ar.tupId=DzElementId;
		ar.tupNum=TupNum;
		aes(ar, "endGetLike");

	}
		function endGetLike(rs) {
			
		}	
		
//获得地址
		var lng ="";
		var lat="";
		var userid = "";
		window.BMap_loadScriptTime = (new Date).getTime();
		var map = new BMap.Map("allmap");
		function getPeoplePosition() {
			var geolocation = new BMap.Geolocation();
			geolocation.getCurrentPosition(function(r) {
				if(this.getStatus() == BMAP_STATUS_SUCCESS) {
					lng = r.point.lng;
					lat = r.point.lat;		
					sessionStorage.setItem("lng", lng);
					sessionStorage.setItem("lat", lat);
					$('.JLCSS').each(function() {
						var pointA = new BMap.Point(lng, lat);
						var pointB = new BMap.Point($(this).attr('LNGG'), $(this).attr('disment'));
						var jl = map.getDistance(pointA, pointB).toFixed(2);
						var jlstring = "";
						if(jl / 1000 > 1) {
							var jlaa = Math.round(parseFloat(jl / 1000) * 100) / 100;
							jlstring = jlaa + "km";
						} else {
							jlstring = parseInt(jl) + "m";
						}
						$(this).html(jlstring);
					})
					setTimeout(function() {
						var ar = new Array();
						ar.LONG = lng;
						ar.Dismension = lat;
						ar.UserPhoneId = userid;
						ar.InterfaceAddress = "api/Mapapi";
						aes(ar, "endClick");
					}, 500);
				} else {
					alert('failed' + this.getStatus());
				}
			}, {
				enableHighAccuracy: true
			})
		}
		function endClick() {}
//点赞对接	

		function Djtext(){
			$("#pingltextare").toggle();
			$(".comment-input").focus();   
			
		}

//分享弹框
		var share = document.getElementById('faxian-fenxiang');
		var dodown = document.getElementById('document-down');

		function show() {
			dodown.style.display = "none";
			share.style.display = "block";
		}

		function hiden() {
			share.style.display = "none";
			dodown.style.display = "block";
		}
		
		
		
//分享开始
		mui.init({
            swipeBack:true //启用右滑关闭功能
        });

        var Intent = null,
            File = null,
            Uri = null,
            main = null;
        var shares = null;
        var shareImageUrl = '';
        mui.plusReady(function() {  
            updateSerivces();
            if (plus.os.name == "Android") {
                Intent = plus.android.importClass("android.content.Intent");
                File = plus.android.importClass("java.io.File");
                Uri = plus.android.importClass("android.net.Uri");
                main = plus.android.runtimeMainActivity();
            }
        })
        /**
         * 更新分享服务
         */
        function updateSerivces() {
            plus.share.getServices(function(s) {
                shares = {};
                for (var i in s) {
                    var t = s[i];
                    shares[t.id] = t;
                }
                outSet("获取分享服务列表成功");
            }, function(e) {
                outSet("获取分享服务列表失败：" + e.message);
            });
        }
        /**
         * 分享操作
         */
        function shareAction(id, ex) {
            var s = null;
            if (!id || !(s = shares[id])) {
                outLine("无效的分享服务！");
                return;
            }
            if (s.authenticated) {
                outSet("---已授权---");
                shareMessage(s, ex);
            } else {
                outSet("---未授权---");
                s.authorize(function() {
                    shareMessage(s, ex);
                }, function(e) {
                    outLine("认证授权失败");
                });
            }
        }
        /**
         * 发送分享消息
         */
//      window.onload = function() {
//      	var urlshare = window.document.location.href;
//      	alert(httppp+urlshare.slice(21));
//     
//      }
//    	var urlshare = window.document.location.href;
//    	var urlshare = "/YLHK/examples/faxian-eat.html";
      	
        function shareMessage(s, ex) {

            var msg = {
                content: '黑卡生活',
                href: 'http://app.fuyou.sc.cn/YLHK/index.html',
                title: '黑卡生活',
                content: '黑卡生活APP，邀您一起愉快生活！',
                thumbs: [],
                pictures: [],
                extra: {
                    scene: ex
                }
            };
            s.send(msg, function() {
                outLine("分享成功!");
            }, function(e) {
                outLine("分享失败!");
            });
        }
        /**
         * 分享按钮点击事件
         */
        function shareHref() {
            var ids = [{
                    id: "weixin", 
                    ex: "WXSceneSession"  /*微信好友*/
                }, {
                    id: "weixin",
                    ex: "WXSceneTimeline" /*微信朋友圈*/
                }],
                bts = [{
                    title: "发送给微信好友"
                }, {
                    title: "分享到微信朋友圈"
                }];
            plus.nativeUI.actionSheet({
                    cancel: "取消",
                    buttons: bts
                },
                function(e) {
                    var i = e.index;
                    if (i > 0) {
                        shareAction(ids[i - 1].id, ids[i - 1].ex);
                    }
                }
            );
        }       
        // 控制台输出日志
        function outSet(msg) {
            console.log(msg);
        }
        // 界面弹出吐司提示
        function outLine(msg) {
            mui.toast(msg);
        }

	
		
//查询评论
		
		
		function GetAccessV(vId) {
			var ar = new Array();
			var ph = {
				Collection: [{
					F: "NodeId",
					O: "=",
					P: "@@NodeId",
					V: vId
				}, ]
			};
			ar.Condition = ph;
			ar.InterfaceAddress = "api/ShopInfo";
			ar.Name = "YL_AccessView";
			ar.OrderBy = "CreationDate desc";
			ar.Index = 0;
			ar.Size = 10;
			ar.Handshake_Time = CurentTime('-', true);
			aes(ar, "endGetAccessV");
		}
		
		function endGetAccessV(rs){
			var TData = eval("(" + rs + ")");
			//GetAccessReply(TData[0].Id);
			for(var i=0;i<TData.length;i++){
						var adata= CurentTimeBydata("-", eval('new ' + eval(TData[i].LastUpdate).source), true);
						var ahtml='<div class="comment-show-con clearfix" id="'+TData[i].Id+'"><div class="comment-show-con-img pull-left" style="width: 18%;"><img src="../images/header-img-comment_03.png" alt=""></div>';
						ahtml+='<div class="comment-show-con-list pull-left clearfix">	<div class="pl-text clearfix">';
						ahtml+='<a href="#" class="comment-size-name">'+TData[i].UserName+' : </a>';
						ahtml+='<span class="my-pl-con">&nbsp;'+TData[i].CommentInfo+'</span>	</div>';
						ahtml+='<div class="date-dz"><span class="date-dz-left pull-left comment-time">'+adata+'</span>';
						ahtml+='<div class="date-dz-right pull-right comment-pl-block">';
						//ahtml+='<a href="javascript:;" class="date-dz-pl pl-hf hf-con-block pull-left" id="'+TData[i].Id+'">回复</a><span class="pull-left date-dz-line">|</span>';
						ahtml+='<a href="javascript:;" class="date-dz-z pull-left" id="'+TData[i].Id+'"><i class="date-dz-z-click-red"></i>赞 (<i class="z-num">'+TData[i].TUP+'</i>)</a></div></div>';
						ahtml+='<div class="hf-list-con" id="'+TData[i].Id+'1"></div></div></div>';
						document.getElementById("comment-show").innerHTML+=ahtml;
			}
		}
		
		//查询评论方法
		

//产品详情

		function getQueryString(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
			var r = window.location.search.substr(1).match(reg);
			if(r != null) return unescape(r[2]);
			return null;
		}
		var relid = getQueryString("id");
		GetActic();

		function GetActic() {
			var ar = new Array();
			var ph = {
				Collection: [{
					F: "Id",
					O: "=",
					P: "@@Id",
					V: relid
				}, ]
			};
			ar.Condition = ph;
			ar.InterfaceAddress = "api/ShopInfo";
			ar.Name = "YL_Article";
			ar.OrderBy = "CreationDate desc";
			ar.Index = 0;
			ar.Size = 1;
			ar.Handshake_Time = CurentTime('-', true);
			aes(ar, "endGetActic");
		}
		
		var nodeId="";
		function endGetActic(rs) {
			var TData = eval("(" + rs + ")");
			GetAccessV(TData[0].Id);
			nodeId = TData[0].Id;
			$('#proName').text(TData[0].ArticleType);
			document.getElementById("bianji-text").innerHTML = TData[0].ArticleContent;
			$('#bianji-text p img').css("width", '100%');
			
		}

	</script>

</html>